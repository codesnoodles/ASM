# 输入输出控制技术
----
## 输入输出接口概述
----
1. cpu与外设之间的联系。
2. 接口电路的接本结构

## cpu与外设之间数据传送的方式
----
### 程序传送

1. 无条件传送，往外传送需要锁存器，向cpu传送需要缓冲器。
2. 程序查询传送，检查寄存器的状态，来确定是否进行传输。
	* 程序查询输入
	* 程序查询输出
	* 查询方式的数据采集系统
3. 中断传送，所谓中断是指外设或其他中断源，中止cpu在执行的程序，转到为该外设服务，一旦服务结束，继续源程序。
4. 直接存储器存取传送。由专门的硬件电路执行io交换的传送方式，它可以使得外设接口直接与内存进行高速的数据传送。

## 中断技术
----
### 中断概述
有中断，就有中断源中断源由四种：
* 外部设备，一般为慢速外设
* 实时时钟
* 故障源，计算机内设有故障自动检测装置
* 为调试程序设置的的中断源

中断系统用来处理中断过程以及中断控制逻辑
* 能响应中断，处理中断，并返回。
* 能实现优先权排队。
* 高级中断能中断低级中断的处理过程

### 单个中断源的中断

中断源 通过接口电路向cpu发中断请求信号
1. 设置中断请求触发器。可由标志位设置
2. 设置中断屏蔽触发器，可由标志位设置

cpu响应中断要求
1. cpu开放中断，要求IFF=1
2. cpu在现行指令结束后响应中断

cpu响应中断及处理过程
1. 关中断，防止后续中断源申请，造成当前中断丢失
2. 保留断点，将断点地址压栈保护
3. 保护现场寄存器内容压栈保护
4. 给中断入口，转入相对应的中断服务中
5. 恢复现场
6. 开中断与返回

### 向量中断
### 中断优先权

## 8086/8088 的中断系统和中断处理
----
### 8086/8088的中断系统
1. 外部中断：一条是高电平有效的可屏蔽中断INTR，一条是正跳变有效的非屏蔽中断NML
	* 可屏蔽中断
	* 非屏蔽中断
2. 内部中断
	* 除法出错中断----类型0
	* 溢出中断----类型4
	* 单步中断----类型1
	* 断点中断----类型3
	* 用户自定义的软件中断----类型n
3. 内部中断的特点
	* 内部中断由一条 INT n指令直接产生
	* 除开单步中断，所有内部中断不会被屏蔽
	* 由于内部中断不必进行查询外部来获得中断型号，所以没有中断响应INTA机器总线周期
	* 软件优先级排队如下：

|优先级|中断名|中断类型|说明|
|-----|-----|-----|-----|
|1|除法错| 类型0 |商大于被除数|
|2|INT n|类型n|内部检查用中断|
|3|INTO|类型4|溢出|
|4|NMI|类型2|非屏蔽中断|
|5|INTR|由外设送入|可屏蔽中断|
|6|单步|类型1|调试用|

4. 向量中断表，外设通过接口讲一个**8位的中断类型编码n** cpu对编码n**乘以4**得到指向该中断向量首字节的地址**4n和4n+1存放的是偏移地址**，**4n+2，4n+3存放的事段地址**


### 8086/8088 cpu中断处理过程

1. 所用中断处理都包括 ，中断请求、中断响应、中断处理，和中断返回这四个基本过程。

### 中断时序响应

## 可编程中断控制器
----
### 引脚功能及功能结构
### 8259A内部结构框图
1. 数据总线缓冲器
2. 读写逻辑
3. 级联缓冲器
4. 控制逻辑
5. 中断请求寄存器
6. 中断服务寄存器
7. 中断屏蔽寄存器 
8. 优先级别判别器

### 8259 控制字格式

## 计数/定时控制技术
----
### 8253芯片寻址方式

8253-5内部由三个计数器和一个控制寄存器可通过地址线和读写控制线选片进行寻址：

|$A_1$|$A_0$| $\overline{\text{RD}}$ | $\overline{\text{WR}}$ | $\overline{\text{CS}}$ |操作|
|----|-----|----|----|----|----|
|0|0|0|1|0|读0|
|0|1|0|1|0|读1|
|1|0|0|1|0|读2| 
|0|0|1|0|0|写0|
|0|1|1|0|0|写1| 
|1|0|1|0|0|写2|
|1|1|1|0|0|写方式控制字|
|x|x|x|x|1|禁止|
|1|1|0|1|0|无操作|
|x|x|1|1|0|无操作|

### 8253-5 的6种工作方式
|$SC_1$|$SC_0$|$RL_1$|$RL_0$|$M_2$|$M_1$|$M_0$|$BCD$|
|--|--|--|--|--|--|--|--|

* $SC_1$$SC_0$ 一起决定计数器选择哪一个
* $RL_1$$RL_0$ 一起决定操作选择，
	* 00 寄存器锁存
	* 01 对低字节读写
	* 10 对高字节读写
	* 11 先读写低字节，在读写高字节
* $M_2$$M_1$$M_0$  一起决定工作方式
* BCD 决定计数方式 0-二进制 1-bcd码

1. 计数结束产生中断。
2. 可编程单稳触发器。
3. 分频器
4. 方波频率发生器
5. 软件触发选通脉冲
6. 硬件触发选通脉冲












